groups:
- name: novax_core
  rules:
  - record: novax_dd_1h_pct_max_5m
    expr: max_over_time(novax_dd_1h_pct[5m])
  - record: novax_dd_24h_pct_max_5m
    expr: max_over_time(novax_dd_24h_pct[5m])

  - alert: NovaXBotDisabled
    expr: novax_bot_enabled == 0
    for: 5m
    labels: {severity: warning}
    annotations: {summary: "Bot disabled >5m"}

  - alert: NovaXDD1hBreach
    expr: novax_dd_1h_pct_max_5m >= 4
    for: 2m
    labels: {severity: critical}
    annotations: {summary: "DD 1h >= 4%"}

  - alert: NovaXDD24hBreach
    expr: novax_dd_24h_pct_max_5m >= 10
    for: 5m
    labels: {severity: critical}
    annotations: {summary: "DD 24h >= 10%"}

  - alert: NovaXHeartbeatStale
    expr: novax_heartbeat_age_s > 180
    for: 2m
    labels: {severity: critical}
    annotations: {summary: "Heartbeat stale > 180s"}

  - alert: NovaXPositionsWhileDisabled
    expr: (novax_bot_enabled == 0) and (novax_positions_open > 0)
    for: 1m
    labels: {severity: critical}
    annotations: {summary: "Open positions while bot disabled"}

  - alert: NovaXUniverseShrunk
    expr: novax_universe_size < 280
    for: 10m
    labels: {severity: warning}
    annotations: {summary: "Universe < 280"}

  - alert: NovaXNoTrades24h
    expr: increase(novax_trades_count[24h]) < 1
    for: 1h
    labels: {severity: warning}
    annotations: {summary: "No trades in last 24h"}

  - alert: NovaXHighSlippage
    expr: novax_trades_slip_open_bps_p90 > 80
    for: 30m
    labels: {severity: info}
    annotations: {summary: "Trade slippage p90 > 80 bps"}
